<% layout("layouts/boilerplate") %>


<h2 class="mt-3"><%= listing.title %></h2>

<div class="listing-card">
  <img src="<%= listing.image.url %>" class="listing-image">

  <div class="listing-content">
    <div>
      <h2><%= listing.title %></h2>
      <p>Owned By : <%= listing.owner.username %></p>
      <p><%= listing.description %></p>
      <p><strong>ğŸ“ Location:</strong> <%= listing.location %></p>
      <p><strong>ğŸŒ Country:</strong> <%= listing.country %></p>
    </div>

    <div class="actions">
      <span style="font-size:18px;font-weight:bold;color:#e63946;">
        â‚¹ <%= listing.price.toLocaleString("en-IN") %> / night
      </span>


<% if (currUser && currUser._id.equals(listing.owner._id)) { %>
  <div class="action-buttons">

    <!-- EDIT BUTTON -->
    <a 
      href="/listings/<%= listing._id %>/edit" 
      class="btn btn-primary"
    >
      Edit
    </a>

    <!-- DELETE BUTTON -->
    <form 
      action="/listings/<%= listing._id %>?_method=DELETE" 
      method="POST" 
      style="display:inline;"
    >
      <button class="btn btn-danger">
        Delete
      </button>
    </form>

  </div>
<% } %>


    </div>
  </div>
</div>

<hr>



<% if (listing.reviews.length === 0) { %>
    <p>No reviews yet</p>
<% } else{%>
    <h4 class="mt-4">Reviews</h4>
<% } %>

<div class="row">
  <% for (let review of listing.reviews) { %>
    <div class="col-6 mb-3">
      <div class="card p-2">

        <p><%= review.comment %></p>
          <p class="starability-result" data-rating="<%= review.rating %>">
            <%= review.rating %>
          </p>


        
        <form action="/listings/<%= listing._id %>/reviews/<%= review._id %>?_method=DELETE" method="post">
        <button class="btn btn-sm btn-dark">Delete</button>
      </form>
      </div>

      
    </div>
  <% } %>
</div>

<hr>



<div class="col-10 col-md-8 offset-md-2 mt-4">
  <div class="review-box shadow-sm p-4 rounded">

    <h5 class="mb-3 text-center">Leave a Review</h5>

    <form 
      action="/listings/<%= listing._id %>/reviews" 
      method="POST" 
      novalidate
      class="needs-validation"
    >

<div class="mb-4 text-center">
  <label class="form-label fw-semibold mb-2">
    Your Rating
  </label>

  <fieldset class="starability-slot mx-auto">
    <!-- hidden required input -->
    <input type="radio" name="review[rating]" value="" required hidden>

    <input type="radio" id="rate1" name="review[rating]" value="1">
    <label for="rate1" title="Terrible">1 star</label>

    <input type="radio" id="rate2" name="review[rating]" value="2">
    <label for="rate2" title="Not good">2 stars</label>

    <input type="radio" id="rate3" name="review[rating]" value="3">
    <label for="rate3" title="Average">3 stars</label>

    <input type="radio" id="rate4" name="review[rating]" value="4">
    <label for="rate4" title="Very good">4 stars</label>

    <input type="radio" id="rate5" name="review[rating]" value="5">
    <label for="rate5" title="Amazing">5 stars</label>
  </fieldset>
</div>


      <div class="mb-3">
        <label class="form-label fw-semibold">Your Comment</label>
        <textarea 
          name="review[comment]" 
          class="form-control" 
          rows="3"
          placeholder="Share your experience..."
          required
        ></textarea>
      </div>

      <div class="text-center">
        <button class="btn btn-dark px-4">
          Submit Review
        </button>
      </div>

    </form>
  </div>
</div>
