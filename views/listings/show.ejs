<% layout("layouts/boilerplate") %>

<style>
  .listing-card {
    max-width: 1100px;
    margin: 30px auto;
    display: flex;
    border-radius: 14px;
    overflow: hidden;
    font-family: Arial, sans-serif;
  }

  .listing-image {
    width: 55%;
    object-fit: cover;
    border-radius: 14px;
  }

  .listing-content {
    padding: 20px;
    width: 60%;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
  }

  .actions {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-top: 14px;
  }

  .action-buttons {
    display: flex;
    gap: 10px;
  }

  @media (max-width: 768px) {
    .listing-card {
      flex-direction: column;
    }

    .listing-image {
      width: 100%;
      height: 240px;
      border-radius: 0;
    }

    .listing-content {
      width: 100%;
    }
  }
</style>

<h2 class="mt-3"><%= listing.title %></h2>

<div class="listing-card">
  <img src="<%= listing.image.url %>" class="listing-image">

  <div class="listing-content">
    <div>
      <h2><%= listing.title %></h2>
      <p><%= listing.description %></p>
      <p><strong>üìç Location:</strong> <%= listing.location %></p>
      <p><strong>üåç Country:</strong> <%= listing.country %></p>
    </div>

    <div class="actions">
      <span style="font-size:18px;font-weight:bold;color:#e63946;">
        ‚Çπ <%= listing.price.toLocaleString("en-IN") %> / night
      </span>

      <div class="action-buttons">
        <a href="/listings/<%= listing._id %>/edit" class="btn btn-primary">Edit</a>

        <form action="/listings/<%= listing._id %>?_method=DELETE" method="POST">
          <button class="btn btn-danger">Delete</button>
        </form>
      </div>
    </div>
  </div>
</div>

<hr>



<% if (listing.reviews.length === 0) { %>
    <p>No reviews yet</p>
<% } else{%>
    <h4 class="mt-4">Reviews</h4>
<% } %>

<div class="row">
  <% for (let review of listing.reviews) { %>
    <div class="col-6 mb-3">
      <div class="card p-2">
        <p>
          <% for (let i = 0; i < review.rating; i++) { %>
            ‚≠ê
          <% } %>
        </p>
        <p><%= review.comment %></p>
        
        <form action="/listings/<%= listing._id %>/reviews/<%= review._id %>?_method=DELETE" method="post">
        <button class="btn btn-sm btn-dark">Delete</button>
      </form>
      </div>

      
    </div>
  <% } %>
</div>

<hr>


<div class="col-8 offset-1">
  <h5>Leave a review</h5>
  <form action="/listings/<%= listing._id %>/reviews" method="post" novalidate class="needs-validation">
    <div class="mb-3">
      <label>Rating</label>
      <input type="range" min="1" max="5" name="review[rating]" required>
    </div>

    <div class="mb-3">
      <label>Comment</label>
      <textarea name="review[comment]" class="form-control" required></textarea>
    </div>

    <button class="btn btn-outline-dark">Submit</button>
  </form>
</div>
